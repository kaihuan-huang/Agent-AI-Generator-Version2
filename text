import json
import pandas as pd
import requests

fname = 'zip.csv'
def save_data(z, mode, p=False, w=False):
    # Opening JSON file
    with open('sample.json', 'r') as openfile:
        # Reading from json file
        json_object = json.load(openfile)
     
    #print(json_object)
    #print(type(json_object))
    
    with open(fname, mode) as f:
        if mode != 'a':
            f.write("num; zip; line1; line2; latitude, longitude; date\n")
        i = 0
        for t in json_object['property']:
            i += 1
            if p:
                print(f"{i}; {z}; {t['address']['line1']}; {t['address']['line2']}; {t['location']['latitude']}; {t['location']['longitude']}; {t['vintage']['pubDate']}")
            if w:
                f.write(f"{i}; {z}; {t['address']['line1']}; {t['address']['line2']}; {t['location']['latitude']}; {t['location']['longitude']}; {t['vintage']['pubDate']}\n")


def get_attomdata_add(z): 
    endpoint = 'https://api.gateway.attomdata.com/propertyapi/v1.0.0/property/address'
        
    headers = {
        'Accept': 'application/json', # specifying that the response should be in JSON format
        'apikey': '2b1e86b638620bf2404521e6e9e1b19e'
    }
    
    params = {
        "listingid": None,
        # the geographic area of the property
        "postalcode": z, 
        'minBeds': 1,
        'maxBeds': 2
    }
    
    response = requests.get(endpoint, headers=headers, params=params,verify=False)
    data = response.json()
    d = json.dumps(data, indent=4)
    with open('sample.json', 'w') as ofile:
        ofile.write(d)
    print('data',data)


#i = '95110'
#get_attomdata(i)
#save_data(i, 'w', True, True)
#i = '95112'
#get_attomdata_add(i)
#save_data(i, 'a', True, True)
#
#data = pd.read_csv(fname, sep=";")
#print(data)